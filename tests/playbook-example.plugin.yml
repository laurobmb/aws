---
- name: AWS Account Management
  hosts: localhost
  connection: local
  gather_facts: false

  vars:
    project: "ProjetoDemo4"
    email: "lauroinf+demo4@hotmail.com"
    destination_ou_id: "ou-jojo-zeg98nd3"

    # üìù NOVAS VARI√ÅVEIS ADICIONADAS
    # Nome do role customizado a ser criado na conta.
    # Se n√£o quiser customizar, voc√™ pode remover essa linha e o par√¢metro da task.
    role_name_custom: "OrganizationAccountAccessRole"

    # Lista de tags a serem aplicadas na conta.
    # Note o formato: √© uma lista de dicion√°rios com 'Key' e 'Value'.
    tags_da_conta:
      - Key: Project
        Value: "{{ project }}" # Boa pr√°tica: reutilizando a vari√°vel do projeto
      - Key: Environment
        Value: "development"
      - Key: AutomationTool
        Value: "Ansible"

  tasks:
    # üöÄ TASK ATUALIZADA COM OS NOVOS PAR√ÇMETROS
    - name: Criar nova conta AWS com Role e Tags
      laurobmb.aws.aws_manage_account:
        action: create_account
        email: "{{ email }}"
        projeto: "{{ project }}"
        role_name: "{{ role_name_custom }}"
        account_tags: "{{ tags_da_conta }}"
      register: create_account_result

    - name: Mostrar o resultado completo da cria√ß√£o
      ansible.builtin.debug:
        var: create_account_result

    - name: Mover a conta rec√©m-criada para a OU de destino
      laurobmb.aws.aws_manage_account:
        action: move_account
        account_id: "{{ create_account_result.status.AccountId }}"
        destination_ou_id: "{{ destination_ou_id }}"
      when: create_account_result.changed
