---
- name: AWS Account Management
  hosts: localhost
  connection: local
  gather_facts: false

  vars:
    project: "ProjetoDemo3"
    email: "lauroinf+demo3@hotmail.com"
    destination_ou_id: "ou-jojo-zeg98nd3"

  tasks:
    - name: Criar nova conta AWS
      laurobmb.aws.aws_manage_account:
        action: create_account
        email: "{{ email }}"
        projeto: "{{ project }}"
      register: create_account_result

    - name: Mostrar o resultado completo da criação
      ansible.builtin.debug:
        var: create_account_result

    - name: Mover a conta recém-criada para a OU de destino
      laurobmb.aws.aws_manage_account:
        action: move_account
        account_id: "{{ create_account_result.status.AccountId }}"
        destination_ou_id: "{{ destination_ou_id }}"
      when: create_account_result.changed
